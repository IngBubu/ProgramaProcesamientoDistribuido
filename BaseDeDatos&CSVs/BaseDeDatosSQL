-- Creaci√≥n de la base de datos
CREATE DATABASE Empresa;
GO

USE Empresa;
GO

CREATE TABLE TICKETSH (
    FOLIO VARCHAR(8) NOT NULL PRIMARY KEY,
    FECHA DATE NOT NULL,
    IDESTADO INT NOT NULL,
    IDCIUDAD INT NOT NULL,
    IDTIENDA INT NOT NULL,
    IDEMPLEADO INT NOT NULL
);
GO

CREATE TABLE TICKETSD (
    FOLIO VARCHAR(8) NOT NULL,
    IDPRODUCTO INT NOT NULL,
    UNIDADES INT NOT NULL,
    PRECIO INT NOT NULL,
    TOTAL INT NOT NULL,
    PRIMARY KEY (FOLIO, IDPRODUCTO),
    FOREIGN KEY (FOLIO) REFERENCES TICKETSH(FOLIO) ON DELETE CASCADE
);
GO

CREATE NONCLUSTERED INDEX idx_estado ON TICKETSH(IDESTADO);
CREATE NONCLUSTERED INDEX idx_ciudad ON TICKETSH(IDCIUDAD);
CREATE NONCLUSTERED INDEX idx_tienda ON TICKETSH(IDTIENDA);
CREATE NONCLUSTERED INDEX idx_empleado ON TICKETSH(IDEMPLEADO);
CREATE NONCLUSTERED INDEX idx_producto ON TICKETSD(IDPRODUCTO);
CREATE NONCLUSTERED INDEX idx_ticket_precio ON TICKETSD(FOLIO, PRECIO);
CREATE NONCLUSTERED INDEX idx_ticket_total ON TICKETSD(FOLIO, TOTAL);
GO

BULK INSERT TICKETSH
FROM 'C:\TESEBADA\CSV\TicketH.csv'
WITH
(
    FIELDTERMINATOR = ',', 
    ROWTERMINATOR = '\n',  
    FIRSTROW = 2           
);

BULK INSERT TICKETSD
FROM 'C:\TESEBADA\CSV\TicketD.csv'
WITH
(
    FIELDTERMINATOR = ',', 
    ROWTERMINATOR = '\n',   
    FIRSTROW = 2           
);

